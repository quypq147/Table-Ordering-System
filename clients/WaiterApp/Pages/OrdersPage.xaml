<?xml version="1.0" encoding="UTF-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="WaiterApp.Pages.OrdersPage"
             Title="ĐƠN HÀNG">
    <ContentPage.Content>
        <Grid RowDefinitions="Auto,Auto,*"
              Padding="16"
              BackgroundColor="#F5F6F8">

            <!-- Filter trạng thái -->
            <Grid Grid.Row="0"
                  ColumnDefinitions="*,*,*"
                  Margin="0,0,0,8">
                <Button x:Name="BtnPending"
                        Text="Mới"
                        Clicked="OnFilterClicked"
                        CornerRadius="18"
                        HeightRequest="36" />
                <Button Grid.Column="1"
                        x:Name="BtnPreparing"
                        Text="Đang làm"
                        Clicked="OnFilterClicked"
                        CornerRadius="18"
                        HeightRequest="36" />
                <Button Grid.Column="2"
                        x:Name="BtnCompleted"
                        Text="Hoàn tất"
                        Clicked="OnFilterClicked"
                        CornerRadius="18"
                        HeightRequest="36" />
            </Grid>

            <!-- Ô tìm kiếm -->
            <SearchBar Grid.Row="1"
                       x:Name="SearchBar"
                       Placeholder="Tìm bàn / mã đơn"
                       Margin="0,0,0,8"
                       TextChanged="OnSearchChanged" />

            <!-- Danh sách đơn -->
            <RefreshView Grid.Row="2"
                         x:Name="OrdersRefresh"
                         IsRefreshing="{Binding IsRefreshing}"
                         Command="{Binding RefreshCommand}">
                <CollectionView x:Name="OrdersCollection"
                                SelectionMode="Single"
                                SelectionChanged="OnOrderSelected">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame HasShadow="True"
                                   CornerRadius="16"
                                   Padding="12"
                                   Margin="6"
                                   BackgroundColor="White">
                                <Grid RowDefinitions="Auto,Auto"
                                      ColumnDefinitions="*,Auto">

                                    <!-- Thông tin bàn + giờ -->
                                    <StackLayout Grid.Row="0"
                                                 Grid.Column="0"
                                                 Spacing="2">
                                        <Label Text="{Binding TableCode}"
                                               FontAttributes="Bold"
                                               FontSize="16" />
                                        <Label Text="{Binding CreatedAtUtc, StringFormat='Lúc {0:HH\\:mm}'}"
                                               FontSize="12"
                                               TextColor="#6b7280" />
                                    </StackLayout>

                                    <!-- Trạng thái đơn -->
                                    <Label Grid.Row="0"
                                           Grid.Column="1"
                                           Text="{Binding Status}"
                                           FontSize="12"
                                           HorizontalOptions="End"
                                           VerticalOptions="Start"
                                           Padding="8,2">
                                        <Label.Triggers>
                                            <!-- Mới tạo -->
                                            <DataTrigger TargetType="Label"
                                                         Binding="{Binding Status}"
                                                         Value="Submitted">
                                                <Setter Property="Text" Value="Mới" />
                                                <Setter Property="BackgroundColor" Value="#fee2e2" />
                                                <Setter Property="TextColor" Value="#b91c1c" />
                                            </DataTrigger>

                                            <!-- Đang làm -->
                                            <DataTrigger TargetType="Label"
                                                         Binding="{Binding Status}"
                                                         Value="InProgress">
                                                <Setter Property="Text" Value="Đang làm" />
                                                <Setter Property="BackgroundColor" Value="#fef9c3" />
                                                <Setter Property="TextColor" Value="#92400e" />
                                            </DataTrigger>

                                            <!-- Món đã sẵn sàng -->
                                            <DataTrigger TargetType="Label"
                                                         Binding="{Binding Status}"
                                                         Value="Ready">
                                                <Setter Property="Text" Value="Sẵn sàng" />
                                                <Setter Property="BackgroundColor" Value="#e0f2fe" />
                                                <Setter Property="TextColor" Value="#1d4ed8" />
                                            </DataTrigger>

                                            <!-- Chờ thanh toán -->
                                            <DataTrigger TargetType="Label"
                                                         Binding="{Binding Status}"
                                                         Value="WaitingForPayment">
                                                <Setter Property="Text" Value="Chờ thanh toán" />
                                                <Setter Property="BackgroundColor" Value="#ffedd5" />
                                                <Setter Property="TextColor" Value="#9a3412" />
                                            </DataTrigger>

                                            <!-- Đã thanh toán -->
                                            <DataTrigger TargetType="Label"
                                                         Binding="{Binding Status}"
                                                         Value="Paid">
                                                <Setter Property="Text" Value="Đã thanh toán" />
                                                <Setter Property="BackgroundColor" Value="#dcfce7" />
                                                <Setter Property="TextColor" Value="#166534" />
                                            </DataTrigger>

                                            <!-- Đã hủy -->
                                            <DataTrigger TargetType="Label"
                                                         Binding="{Binding Status}"
                                                         Value="Cancelled">
                                                <Setter Property="Text" Value="Đã hủy" />
                                                <Setter Property="BackgroundColor" Value="#fee2e2" />
                                                <Setter Property="TextColor" Value="#b91c1c" />
                                            </DataTrigger>
                                        </Label.Triggers>
                                    </Label>

                                    <!-- Dòng mô tả dưới -->
                                    <Label Grid.Row="1"
                                           Grid.Column="0"
                                           Grid.ColumnSpan="2"
                                           Text="{Binding PendingItems, StringFormat='Món đang chờ: {0}'}"
                                           FontSize="12"
                                           TextColor="#6b7280" />
                                </Grid>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </RefreshView>
        </Grid>
    </ContentPage.Content>
</ContentPage>


