@page "/chat"

<div class="container py-3 bg-light min-vh-100">
    <h5 class="mb-3">TRÒ CHUYỆN</h5>

    <div class="d-flex flex-wrap gap-2 mb-3">
        @foreach (var f in floors)
        {
            <button class="btn @GetFloorBtnClass(f)" @onclick="(() => SelectFloor(f))">@GetFloorText(f)</button>
        }
    </div>

    <div class="list-group shadow-sm">
        @if (filteredMessages.Count == 0)
        {
            <div class="alert alert-secondary">Không có tin nhắn</div>
        }
        else
        {
            @foreach (var msg in filteredMessages)
            {
                <div class="list-group-item">
                    <div class="d-flex justify-content-between">
                        <div>
                            <div class="fw-bold">@msg.Sender</div>
                            <div class="text-muted small">@msg.Content</div>
                        </div>
                        <span class="badge text-bg-secondary">@msg.TableLabel</span>
                    </div>
                </div>
            }
        }
    </div>
</div>

@code {
    private enum Floor { Floor1, Floor2, Floor3, Ground, TakeAway }

    private readonly List<Floor> floors = new() { Floor.Floor1, Floor.Floor2, Floor.Floor3, Floor.Ground, Floor.TakeAway };
    private Floor activeFloor = Floor.Floor1;

    private List<ChatMessageVm> allMessages = new()
    {
        new("Nhân viên", "Khách yêu cầu thêm sốt mayo", "Bàn 1", Floor.Floor1),
        new("Nhân viên", "Xin thêm muỗng", "Bàn 5", Floor.Floor2),
        new("Nhân viên", "Mang đi: thêm thìa", "Đơn T-12", Floor.TakeAway),
    };

    private List<ChatMessageVm> filteredMessages = new();

    protected override void OnInitialized()
    {
        ApplyFilter();
    }

    private void SelectFloor(Floor f)
    {
        activeFloor = f;
        ApplyFilter();
    }

    private void ApplyFilter()
    {
        filteredMessages = allMessages.Where(m => m.Floor == activeFloor).ToList();
    }

    private string GetFloorText(Floor f) => f switch
    {
        Floor.Floor1 => "Tầng 1",
        Floor.Floor2 => "Tầng 2",
        Floor.Floor3 => "Tầng 3",
        Floor.Ground => "Tầng trệt",
        Floor.TakeAway => "Mang đi",
        _ => f.ToString()
    };

    private string GetFloorBtnClass(Floor f)
    {
        var active = activeFloor == f;
        return active ? "btn-primary" : "btn-outline-secondary";
    }

    private record ChatMessageVm(string Sender, string Content, string TableLabel, Floor Floor);
}
