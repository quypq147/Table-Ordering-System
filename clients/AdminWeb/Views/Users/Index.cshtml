@model List<AdminWeb.Dtos.UserVm>
@{
 ViewData["Title"] = "Tài khoản";
 var total = Model?.Count ??0;
}

<div class="d-flex align-items-center justify-content-between mb-3">
 <div>
 <h2 class="mb-0">Quản lý tài khoản</h2>
 <small class="text-muted">Tổng số: <span class="fw-semibold">@total</span></small>
 </div>
 <div>
 <a class="btn btn-success" asp-controller="Users" asp-action="Create">+ Tạo tài khoản</a>
 </div>
</div>

@if (TempData["Success"] is string ok)
{
 <div class="alert alert-success alert-dismissible fade show" role="alert">
 @ok
 <button type="button" class="btn btn-close" data-bs-dismiss="alert" aria-label="Đóng"></button>
 </div>
}
@if (TempData["Error"] is string err)
{
 <div class="alert alert-danger alert-dismissible fade show" role="alert">
 @err
 <button type="button" class="btn btn-close" data-bs-dismiss="alert" aria-label="Đóng"></button>
 </div>
}

<div class="card shadow-sm">
 <div class="card-body p-0">
 <div class="table-responsive" style="max-height:65vh;">
 <table class="table table-hover table-striped align-middle mb-0">
 <thead class="table-light" style="position: sticky; top:0; z-index:1;">
 <tr>
 <th>UserName</th>
 <th>Họ và tên</th>
 <th>Email</th>
 <th>Vai trò</th>
 <th style="width:140px">Trạng thái</th>
 <th class="text-end" style="width:220px">Thao tác</th>
 </tr>
 </thead>
 <tbody>
 @foreach (var u in Model)
 {
 <tr>
 <td class="fw-semibold">@u.UserName</td>
 <td>@u.FullName</td>
 <td>@u.Email</td>
 <td>@string.Join(", ", u.Roles ?? Array.Empty<string>())</td>
 <td>
 @if (u.IsActive)
 {
 <span class="badge rounded-pill bg-success">Đang hoạt động</span>
 }
 else
 {
 <span class="badge rounded-pill bg-secondary">Vô hiệu</span>
 }
 </td>
 <td class="text-end">
 <div class="btn-group">
 <a class="btn btn-sm btn-outline-secondary" asp-action="Edit" asp-route-id="@u.Id" data-bs-toggle="tooltip" data-bs-title="Chỉnh sửa">Sửa</a>
 <a class="btn btn-sm btn-outline-primary" asp-action="Permissions" asp-route-id="@u.Id" data-bs-toggle="tooltip" data-bs-title="Phân quyền">Quyền</a>
 <form method="post" asp-action="Deactivate" asp-route-id="@u.Id" class="d-inline" onsubmit="return confirm('Vô hiệu hóa tài khoản này?');">
 @Html.AntiForgeryToken()
 <button class="btn btn-sm btn-outline-danger" data-bs-toggle="tooltip" data-bs-title="Vô hiệu hóa">Vô hiệu</button>
 </form>
 </div>
 </td>
 </tr>
 }
 </tbody>
 </table>
 </div>

 @if (!Model.Any())
 {
 <div class="p-4">
 <div class="alert alert-info mb-0">
 <div class="d-flex align-items-center gap-2">
 <div>??</div>
 <div>
 <div class="fw-semibold">Chưa có tài khoản nào.</div>
 <div class="small text-muted">Nhấn "+ Tạo tài khoản" ?? thêm mới.</div>
 </div>
 </div>
 </div>
 </div>
 }
 </div>
</div>

@section Scripts
{
 <script>
 (function(){
 const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
 tooltipTriggerList.forEach(el => new bootstrap.Tooltip(el));
 })();
 </script>
}
